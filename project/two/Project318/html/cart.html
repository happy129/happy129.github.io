<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>千秋大业一壶茶--商品</title>
    <link rel="stylesheet" href="//at.alicdn.com/t/font_1091477_6ew91velsl8.css">
    <link rel="stylesheet" href="../css/cart.css">
    <link rel="stylesheet" href="../css/style.css">
    <!-- <link rel="stylesheet" href="../css/common.css"> -->
</head>

<body>
    <div id="header">
        <div id="h-content">
            <ul class="h-left">
                <li>醉品茶城首页</li>
                <li>OMO体验加盟店</li>
                <li>醉品茶城手机版</li>
            </ul>
            <ul class="h-right cart">
                <li class="my-cart">购物车</li>
            </ul>
            <ul class="h-right enter">
                <li class="account login"><a href="login.html">登录</a> </li>
                <li class="order"><a href="">我的订单</a> </li>
                <li class="help"><a href="">帮助中心</a> </li>
                <li class="about"><a href="">关于我们</a> </li>
            </ul>
        </div>
    </div>
    <div class="top-hf">
        <a href="">
            <!-- <img src="../img/hf.gif" alt=""> -->
        </a>
    </div>
    <div class="headerTap">
        <div class="headerTap-top">
            <div class="logo">
                <a href="">
                    <img src="../img/logo.gif" alt="">
                </a>
            </div>
            <div class="search-box">
                <form action="" id="list">
                    <input type="text" name="keyword" value class="search-text">
                </form>
                <span class="search-btn iconfont icon-search" id="sub"></span>
                <div class="clearfix" id="key-word">
                    <a href="">白茶</a>
                    <a href="">广东单纵</a>
                    <a href="">龙井</a>
                    <a href="">铁观音</a>
                    <a href="">普洱</a>
                </div>
            </div>
            <div class="three-list">
                <ul class="clearfix">
                    <li>
                        <p class="iconfont icon-baohu">全场商品90天保价</p>
                    </li>
                    <li>
                        <p class="iconfont icon-mianshui">满59元免邮费</p>
                    </li>
                    <li>
                        <p class="iconfont icon-huodaofukuan">2000城市货到付款</p>
                    </li>
                </ul>
            </div>
            <div class="code"></div>
        </div>
        <div class="headerTap-bottom">
            <div class="h-b-ways clearfix">
                <dl class="goods-list"></dl>
                <ul class="row-nav clearfix"></ul>
            </div>
        </div>
    </div>
    <div id="header-sel">
        <div class="header-wrapper clearfix">
            <!-- 商品列表 -->
            <dl class="goods-list">
                <i class="iconfont icon-caidan"></i>
                <dt class="list-all">全部商品分类</dt>

            </dl>
            <ul class="row-nav clearfix">
                <li class="row-nav-list">品牌集成馆</li>
                <li class="row-nav-list">大师名匠馆</li>
                <li class="row-nav-list">线下OMO体验店</li>
                <li class="row-nav-list">积分商城</li>
                <li class="row-nav-list">茶礼定制</li>
            </ul>
        </div>

    </div>

    <div class="catbox">
        <table id="cartTable">
            <thead>
                <tr>
                    <th><label>
                            <input class="check-all check" type="checkbox" />&nbsp;&nbsp;全选</label></th>
                    <th>商品</th>
                    <th>单价</th>
                    <th>数量</th>
                    <th>小计</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody>
                <!-- <tr>
                    <td class="checkbox"><input class="check-one check" type="checkbox" /></td>
                    <td class="goods"><img src="images/1.jpg" alt="" /><span>Casio/卡西欧 EX-TR350</span></td>
                    <td class="price">5999.88</td>
                    <td class="count"><span class="reduce"></span>
                        <input class="count-input" type="text" value="1" />
                        <span class="add">+</span></td>
                    <td class="subtotal">5999.88</td>
                    <td class="operation"><span class="delete">删除</span></td>
                </tr>
                <tr>
                    <td class="checkbox"><input class="check-one check" type="checkbox" /></td>
                    <td class="goods"><img src="images/2.jpg" alt="" /><span>Canon/佳能 PowerShot SX50 HS</span></td>
                    <td class="price">3888.50</td>
                    <td class="count"><span class="reduce"></span>
                        <input class="count-input" type="text" value="1" />
                        <span class="add">+</span></td>
                    <td class="subtotal">3888.50</td>
                    <td class="operation"><span class="delete">删除</span></td>
                </tr>
                <tr>
                    <td class="checkbox"><input class="check-one check" type="checkbox" /></td>
                    <td class="goods"><img src="images/3.jpg" alt="" /><span>Sony/索尼 DSC-WX300</span></td>
                    <td class="price">1428.50</td>
                    <td class="count"><span class="reduce"></span>
                        <input class="count-input" type="text" value="1" />
                        <span class="add">+</span></td>
                    <td class="subtotal">1428.50</td>
                    <td class="operation"><span class="delete">删除</span></td>
                </tr>
                <tr>
                    <td class="checkbox"><input class="check-one check" type="checkbox" /></td>
                    <td class="goods"><img src="images/4.jpg" alt="" /><span>Fujifilm/富士 instax mini 25</span></td>
                    <td class="price">640.60</td>
                    <td class="count"><span class="reduce"></span>
                        <input class="count-input" type="text" value="1" />
                        <span class="add">+</span></td>
                    <td class="subtotal">640.60</td>
                    <td class="operation"><span class="delete">删除</span></td>
                </tr> -->
            </tbody>
        </table>
        <div class="foot" id="foot">
            <label class="fl select-all"><input type="checkbox" class="check-all check" />&nbsp;&nbsp;全选</label>
            <a class="fl delete" id="deleteAll" href="javascript:;">删除</a>
            <div class="fr closing" onclick="getTotal();">结 算</div>
            <input type="hidden" id="cartTotalPrice" />
            <div class="fr total">合计：￥<span id="priceTotal">0.00</span></div>
            <div class="fr selected" id="selected">已选商品<span id="selectedTotal">0</span>件<span class="arrow up">︽</span><span class="arrow down">︾</span></div>
            <div class="selected-view">
                <div id="selectedViewList" class="clearfix">
                    <div><img src="images/1.jpg"><span>取消选择</span></div>
                </div>
                <span class="arrow">◆<span>◆</span></span>
            </div>
        </div>
    </div>

    <div class="consultation-item ">
        <div class="consultion-text">
            <i class="iconfont icon-kefu"></i>
            <p>客服</p>
        </div>
        <div class="consultion-text">
            <i class="iconfont icon-rexiandianhua"></i>
            <p>热线</p>
        </div>
        <div class="consultion-text">
            <i class="iconfont icon-erweima"></i>
            <p>服务号</p>
        </div>
        <div class="consultion-top">
            <i class="iconfont icon-shang"></i>
            <p>顶部</p>
        </div>
    </div>

    <div class="main-footer">
        <div class="foot-wrapper">
            <div class="footer-service">
                <ul class="clearfix">
                    <li class="clearfix"> <i class="iconfont icon-dingwei"></i> <span>原产地直供</span></li>
                    <li class="clearfix"> <i class="iconfont icon-hezuo"></i> <span>1000家合作社联盟</span></li>
                    <li class="clearfix"> <i class="iconfont icon-12"></i> <span>10万亩茶园直供</span></li>
                    <li class="clearfix"> <i class="iconfont icon-baohu"></i> <span>90天商品保价</span></li>
                    <li class="clearfix"> <i class="iconfont icon-tuihuo"></i> <span>30天商品退换货</span></li>
                    <li class="clearfix"> <i class="iconfont icon-mianshui"></i> <span>满59元免运费</span></li>
                </ul>
            </div>
            <div class="footer-links clearfix">
                <dl class="col-links col-links-first">
                    <dt>购物指南</dt>
                    <dd><a rel="nofollow" href="https://www.zuipin.cn/page/shopping#g1" target="_blank">购物保障</a></dd>
                    <dd><a rel="nofollow" href="https://www.zuipin.cn/page/shopping#g2" target="_blank">积分政策</a></dd>
                    <dd><a rel="nofollow" href="https://www.zuipin.cn/page/shopping#g3" target="_blank">企业用户</a></dd>
                </dl>
                <dl class="col-links col-links-first">
                    <dt>配送方式</dt>
                    <dd><a rel="nofollow" href="https://www.zuipin.cn/page/distance#a-1" target="_blank">快递资费</a></dd>
                    <dd><a rel="nofollow" href="https://www.zuipin.cn/page/distance#a-1" target="_blank">配送时间</a></dd>
                    <dd><a rel="nofollow" href="https://www.zuipin.cn/page/distance#a-2" target="_blank">配送范围</a></dd>
                    <dd><a rel="nofollow" href="https://www.zuipin.cn/page/distance#a-3" target="_blank">验货签收</a></dd>
                </dl>
                <dl class="col-links col-links-first">
                    <dt>支付方式</dt>
                    <dd><a rel="nofollow" href="https://www.zuipin.cn/page/paymethod#hdfk" target="_blank">货到付款</a></dd>
                    <dd><a rel="nofollow" href="https://www.zuipin.cn/page/paymethod#wsyh" target="_blank">在线支付</a></dd>
                    <dd><a rel="nofollow" href="https://www.zuipin.cn/page/paymethod#zfb" target="_blank">网银在线</a></dd>
                    <dd><a rel="nofollow" href="https://www.zuipin.cn/page/paymethod#yhzz" target="_blank">银行转账</a></dd>
                </dl>
                <dl class="col-links col-links-first">
                    <dt>售后服务</dt>
                    <dd><a rel="nofollow" href="https://www.zuipin.cn/page/service#thyz" target="_blank">退换货原则</a></dd>
                    <dd><a rel="nofollow" href="https://www.zuipin.cn/page/service#thyz" target="_blank">退换货要求</a></dd>
                    <dd><a rel="nofollow" href="https://www.zuipin.cn/page/service#thyz" target="_blank">运费规则</a></dd>
                    <dd><a rel="nofollow" href="https://www.zuipin.cn/page/service#thlc" target="_blank">退换货流程</a></dd>
                </dl>
                <dl class="col-links col-links-first">
                    <dt>OMO体验店</dt>
                    <dd><a rel="nofollow" href="https://www.zuipin.cn/page/expstore" target="_blank">加盟政策</a></dd>
                    <dd><a rel="nofollow" href="https://www.zuipin.cn/page/expstore" target="_blank">网点分布</a></dd>
                    <dd><a rel="nofollow" href="https://www.zuipin.cn/page/expstore" target="_blank">合作加盟</a></dd>
                </dl>
                <dl class="col-links col-links-first">
                    <dt>关于醉品</dt>
                    <dd><a rel="nofollow" href="https://www.zuipin.cn/page/about" target="_blank">关于我们</a></dd>
                    <dd><a rel="nofollow" href="https://www.zuipin.cn/page/about" target="_blank">醉品动态</a></dd>
                    <dd><a rel="nofollow" href="https://www.zuipin.cn/page/mtsy" target="_blank">媒体声音</a></dd>
                    <dd><a rel="nofollow" href="https://www.zuipin.cn/page/ppjc" target="_blank">品牌集成</a></dd>
                </dl>
                <div class="col-contact">
                    <p class="phone">4006-066-068</p>
                    <p>
                        <span class="J_serviceTime-normal">周一至周日 08:40-22:30</span>
                        <span class="J_serviceTime-holiday" style="display:none;">1月27日至2月2日服务时间 9:00-18:00</span>
                    </p>
                    <a rel="nofollow" class="btn-line-primary" href=""><i class="iconfont icon-xiaoxi"></i><span>在线客服</span> </a>
                </div>
                <div class="col-wap">
                    <img src="https://www.zuipin.cn/web/images/phone_qr.jpg" alt="">
                    <p>醉品茶城手机版</p>
                </div>
            </div>
        </div>
        <div class="footer-info-box">
            <div class="zuipin-wrapper">
                <div class="footer-info clearfix">
                    <div><img src="https://www.zuipin.cn/web/images/common/zui.png" alt=""></div>
                    <div class="col-us">
                        <ul class="clearfix list-about">
                            <li><a href="javascript:;">关于我们</a>|</li>
                            <li><a href="javascript:;" target="_blank">版权申明</a>|</li>
                            <li><a href="javascript:;">成为代理商</a>|</li>
                            <li><a href="javascript:;" target="_blank">联系我们</a></li>
                        </ul>
                        <div class="copyright">
                            <p>&copy; 2010 - 2019 醉品茶城 厦门醉品春秋网络科技有限公司</p>
                        </div>
                        <div><span style="margin-right:20px;">zuipin.cn All Rights Reserved</span><a href="http://www.miibeian.gov.cn/" target="_blank">闽ICP备10200063号-1</a></div>
                    </div>
                    <div style="margin:18px 50px 18px 50px;"><img src="https://www.zuipin.cn/web/images/common/pincha.png" alt=""></div>
                    <div>
                        <ul class="info-links clearfix">
                            <li><a class="clearfix" href="javascript:;"><span>海峡两岸茶业交流协会<br>互联网分会</span></a></li>
                            <li><a class="clearfix" href="javascript:;"><span>315安全服务<br>保障认证</span></a></li>
                            <li><a target="_blank" class="clearfix" href="javascript:;"><span>可信网站<br>示范企业</span></a></li>
                            <li><a target="_blank" class="clearfix" href="javascript:;"><span>安全联盟<br>实名验证</span></a></li>
                            <!-- <li><a target="_blank" class="clearfix" href="javascript:;"><span>工商执照<br>经营允许</span></a></li> -->
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 底部 -->
</body>

<script src="../js/jquery-1.11.3.js"></script>
<script src="../js/cookie.js"></script>
<script src="./js/ajax.js"></script>
<script>
    var tbody = document.getElementById("tbody");
    var loginId = getCookie("loginId");
    if (loginId) {
        $.ajax({
            type: "get",
            url: "php/myshoppingcarlist.php",
            data: {
                userid: loginId
            },
            dataType: "json",
            success: function(list) {
                var html = "";
                list.forEach(function(item) {
                    var {
                        id,
                        goodscode,
                        imgsrc,
                        price,
                        goodsname,
                        num
                    } = item;
                    html += `<tr>
                                <td class="checkbox"><input class="check-one check" type="checkbox" /></td>
                                <td class="goods"><img src="${imgsrc}" alt="" /><span>${goodsname}&nbsp;&nbsp;${goodscode}&nbsp;&nbsp;${rank}</span></td>
                                <td class="price">${prices}</td>
                                <td class="count"><span class="reduce"></span>
                                    <input class="count-input" type="text" value="1" />
                                    <span class="add">+</span></td>
                                <td class="subtotal">${num}*${prices}</td>
                                <td class="operation"><span class="delete">删除</span></td>
                            </tr>`

                });
                tbody.innerHTML = html;
            }

        });
    } else { //没有登录 就跳转到登陆页面 登陆成功以后 在返回
        gotoLogin();
    }

    function addNum(goodsid, addBtn) {

        addBtn.onclick = null;
        $.ajax({
            type: "get",
            url: "php/mycart.php",
            data: {
                userid: loginId,
                goodsid: goodsid,
                num: 1
            },
            dataType: "json",
            success: function(obj) {
                if (obj["code"] == 1) { //数据更新成功
                    var countInput = addBtn.previousElementSibling;
                    countInput.value = countInput.value * 1 + 1;
                    var reduceSpan = countInput.previousElementSibling;
                    reduceSpan.innerHTML = "-";
                    addBtn.goodsid = goodsid;
                    addBtn.onclick = function() {
                        addNum(this.goodsid, this);
                    }
                    var reduceBtn = countInput.previousElementSibling;
                    reduceBtn.goodsid = goodsid;
                    reduceBtn.onclick = function() {
                        reduceNum(this.goodsid, this);
                    }

                    // addBtn.onclick  = addNum(this.goodsid,this); 这么写直接调用


                } else {
                    alert(obj["msg"]);
                }

            }

        });


    }


    function reduceNum(goodsid, reduceBtn) {

        var countInput = reduceBtn.nextElementSibling;
        var countNum = countInput.value;
        if (countNum == 1) {
            return false;
        }
        $.ajax({
            type: "get",
            url: "php/gotomyshoppincar.php",
            data: {
                userid: loginId,
                goodsid: goodsid,
                num: -1
            },
            dataType: "json",
            success: function(obj) {
                if (obj["code"] == 1) { //数据更新成功
                    countInput.value = countInput.value - 1;
                    if (countInput.value == 1) {
                        reduceBtn.innerHTML = "";
                        reduceBtn.onclick = null;
                    } else {
                        reduceBtn.goodsid = goodsid;
                        reduceBtn.onclick = function() {
                            reduceNum(this.goodsid, this);
                        }
                    }
                } else {
                    alert(obj["msg"]);
                }

            }

        });


    }

    function gotoLogin() {
        setCookie("backUrl", window.location.href, 7);
        // window.location.href = "login.html";
        // window.location.href = "login.html?backurl="+window.location.href;
    }
</script>


</html>